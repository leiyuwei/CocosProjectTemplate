{"version":3,"sources":["BaseComponent.ts"],"names":[],"mappings":";;;;;AAEA,yCAAwC;AACxC,yCAAwC;AAMxC;IAA2D,iCAAY;IAAvE;QAAA,qEAwDC;QAtDG,UAAI,GAAwB,EAAE,CAAC;;IAsDnC,CAAC;IAlDG,6BAAK,GAAL,UAAS,SAAuB;QAC5B,OAAO,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACjC,CAAC;IAED,kCAAU,GAAV,UAAW,IAAa,EAAE,MAAc;QAAxC,iBAEC;QADG,IAAI,CAAC,EAAE,CAAC,qBAAS,EAAE,cAAM,OAAA,KAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAjB,CAAiB,CAAC,CAAC;IAChD,CAAC;IAED,wCAAgB,GAAhB,UAAiB,IAAa,EAAE,IAAoB;QAApD,iBAOC;QANG,IAAI,CAAC,EAAE,CAAC,qBAAS,EAAE;YACf,IAAI,MAAM,GAAG,IAAI,EAAE,CAAC;YACpB,IAAI,MAAM,EAAE;gBACR,KAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;aACpB;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED,6CAAqB,GAArB,UAAsB,IAAa,EAAE,IAA2B;QAAhE,iBAOC;QANG,IAAI,CAAC,EAAE,CAAC,qBAAS,EAAE;YACf,IAAI,MAAM,GAAG,IAAI,EAAE,CAAC;YACpB,IAAI,MAAM,CAAC,KAAK,EAAE;gBACd,KAAI,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;aACxB;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED,wCAAgB,GAAhB,UAAiB,IAAa,EAAE,MAAoB;QAChD,IAAI,CAAC,EAAE,CAAC,qBAAS,EAAE,cAAM,OAAA,qBAAS,CAAC,WAAW,EAAE,CAAC,cAAc,CAAC,MAAM,CAAC,EAA9C,CAA8C,CAAC,CAAC;IAC7E,CAAC;IAED,8CAAsB,GAAtB,UAAuB,IAAa,EAAE,IAAoB;QACtD,IAAI,CAAC,EAAE,CAAC,qBAAS,EAAE;YACf,IAAI,MAAM,GAAG,IAAI,EAAE,CAAC;YACpB,IAAI,MAAM,EAAE;gBACR,qBAAS,CAAC,WAAW,EAAE,CAAC,cAAc,CAAC,MAAM,CAAC,CAAA;aACjD;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;;OAGG;IACH,gCAAQ,GAAR,UAAS,MAAoB;QACzB,qBAAS,CAAC,WAAW,EAAE,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;IACnD,CAAC;IAED,iCAAS,GAAT;QACI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAA,GAAG,IAAI,OAAA,GAAG,CAAC,WAAW,EAAE,EAAjB,CAAiB,CAAC,CAAC;IAChD,CAAC;IACL,oBAAC;AAAD,CAxDA,AAwDC,CAxD0D,EAAE,CAAC,SAAS,GAwDtE;AAxDqB,sCAAa","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\basic","sourcesContent":["import { Component } from \"./Component\";\r\nimport { Fn, Effect } from \"./Types\";\r\nimport { TOUCH_END } from \"./Constants\";\r\nimport { GlobalEnv } from \"./GlobalEnv\";\r\nimport { GlobalAction } from \"../core/GlobalAction\";\r\nimport { Maybe } from \"./Maybe\";\r\nimport { Subscription } from \"rxjs\";\r\n\r\n\r\nexport abstract class BaseComponent<State, Action> extends cc.Component implements Component<State, Action> {\r\n    state: State;\r\n    subs: Array<Subscription> = [];\r\n\r\n    abstract eval (action: Action): void;\r\n\r\n    query<T>(extractor: Fn<State, T>) {\r\n        return extractor(this.state);\r\n    }\r\n\r\n    onTouchEnd(node: cc.Node, action: Action) {\r\n        node.on(TOUCH_END, () => this.eval(action));\r\n    }\r\n\r\n    onTouchEndEffect(node: cc.Node, func: Effect<Action>) {\r\n        node.on(TOUCH_END, () => {\r\n            let action = func();\r\n            if (action) {\r\n                this.eval(action)\r\n            }\r\n        });\r\n    }\r\n\r\n    onTouchEndEffectMaybe(node: cc.Node, func: Effect<Maybe<Action>>) {\r\n        node.on(TOUCH_END, () => {\r\n            let action = func();\r\n            if (action.valid) {\r\n                this.eval(action.val)\r\n            }\r\n        });\r\n    }\r\n\r\n    onTouchEndGlobal(node: cc.Node, action: GlobalAction) {\r\n        node.on(TOUCH_END, () => GlobalEnv.getInstance().dispatchAction(action));\r\n    }\r\n\r\n    onTouchEndGlobalEffect(node: cc.Node, func: Effect<Action>) {\r\n        node.on(TOUCH_END, () => {\r\n            let action = func();\r\n            if (action) {\r\n                GlobalEnv.getInstance().dispatchAction(action)\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 向全局发射事件，关心此事件的地方\r\n     * 可以filter指定事件名字，然后监听\r\n     */\r\n    dispatch(action: GlobalAction) {\r\n        GlobalEnv.getInstance().dispatchAction(action);\r\n    }\r\n\r\n    onDestroy() {\r\n        this.subs.forEach(sub => sub.unsubscribe());\r\n    }\r\n}\r\n"]}